$def with (share_links, page_url)
$# :param list[dict] share_links:
$# :param str page_url: absolute url excluding params

$def embed_iframe(page_url):
  <iframe frameborder="0" width="165" height="400" src="$(page_url)/-/widget"></iframe>
  

<style>

@import url('https://fonts.googleapis.com/css2?family=Poppins:wght@200;300;400;500;600;700&display=swap');
*{
  box-sizing: border-box;
}


.view-modal, .popup{
  position: absolute;
}
button{
  outline: none;
  cursor: pointer;
  font-weight: 500;
  border-radius: 4px;
  border: 2px solid transparent;
  transition: background 0.1s linear, border-color 0.1s linear, color 0.1s linear;
}
.view-modal{
  color: #7d2ae8;
  font-size: 18px;
  background: #fff;
  transform: translate(-50%, -50%);
}
.popup{
  background: #fff;
  padding: 25px;
  border-radius: 15px;
  left: 50%;
  max-width: 380px;
  width: 100%;
  opacity: 0;
  pointer-events: none;
  box-shadow: 0px 10px 15px rgba(0,0,0,0.1);
  transform: translate(-50%, -50%) scale(1.2);
  transition: top 0s 0.2s ease-in-out,
              opacity 0.2s 0s ease-in-out,
              transform 0.2s 0s ease-in-out;
  position: fixed;
}
.popup.show{
  top: 50%;
  opacity: 1;
  pointer-events: auto;
  transform:translate(-50%, -50%) scale(1);
  transition: top 0s 0s ease-in-out,
              opacity 0.2s 0s ease-in-out,
              transform 0.2s 0s ease-in-out;
  z-index: 10;

}
.popup :is(header, .icons, .field){
  display: flex;
  align-items: center;
  justify-content: space-between;
}
.popup header{
  padding-bottom: 15px;
  border-bottom: 1px solid #ebedf9;
}
header span{
  font-size: 14px;
  font-weight: 500;
}
header .close, .icons a{
  display: flex;
  align-items: center;
  border-radius: 50%;
  justify-content: center;
  transition: all 0.3s ease-in-out;
}
header .close{
  color: #878787;
  font-size: 17px;
  background: #f2f3fb;
  height: 33px;
  width: 33px;
  cursor: pointer;
}
header .close:hover{
  background: #ebedf9;
}
.popup .content{
  margin: 20px 0;
}
.popup .icons{
  margin: 15px 0 20px 0;
}
.content p{
  font-size: 16px;
}
.content .icons a{
  height: 50px;
  width: 50px;
  font-size: 20px;
  text-decoration: none;
  border: 1px solid transparent;
}
.icons a i{
  transition: transform 0.3s ease-in-out;
}
.icons a:nth-child(1){
  color: #1877F2;
  border-color: #b7d4fb;
}
.icons a:nth-child(1):hover{
  background: #1877F2;
}
.icons a:nth-child(2){
  color: #46C1F6;
  border-color: #b6e7fc;
}
.icons a:nth-child(2):hover{
  background: #46C1F6;
}
.icons a:nth-child(3){
  color: #e1306c;
  border-color: #f5bccf;
}
.icons a:nth-child(3):hover{
  background: #e1306c;
}
.icons a:nth-child(4){
  color: #beb61e;
  border-color: #beb61e;
}
.icons a:nth-child(4):hover{
  background: #beb61e;
}
.icons a:nth-child(5){
  color: #0088cc;
  border-color: #b3e6ff;
}
.icons a:nth-child(5):hover{
  background: #0088cc;
}
.icons a:hover{
  color: #fff;
  border-color: transparent;
}
.icons a:hover i{
  transform: scale(1.2);
}
.content .field{
  margin: 12px 0 -5px 0;
  height: 45px;
  border-radius: 4px;
  padding: 0 5px;
  border: 1px solid #e1e1e1;
}
.field.active{
  border-color: #7d2ae8;
}
.field i{
  width: 50px;
  font-size: 18px;
  text-align: center;
}
.field.active i{
  color: #7d2ae8;
}
.field input{
  width: 100%;
  height: 100%;
  border: none;
  outline: none;
  font-size: 15px;
}
.field button{
  color: #fff;
  padding: 5px 18px;
  background: #7d2ae8;
}
.field button:hover{
  background: #8d39fa;
}
.share-btn {
 width:35px;
 height:35px
}
</style>

  




<head>
  <link rel="stylesheet" href="https://cdnjs.cloudflare.com/ajax/libs/font-awesome/5.15.3/css/all.min.css"/>
  <link rel="stylesheet" href="https://unicons.iconscout.com/release/v3.0.6/css/line.css">
  

  


</head>


<div class="shareLinks cta-section">


  <div>
    <p style="display: inline-block" class="cta-section-title">$_('Share this book')

    </p>
    
    <ul class="shareLinks-list" style="display: inline-block; margin-left: 50px; margin-bottom: 4px;">
      <a class="view-modal">
          <img class="share-btn" src="../../static/images/icons/share.svg"/>
      </a>
    </ul>

  </div>
  
</div>


    <div class="popup">
      <header>
        <span>Share this book</span>
        <div class="close">
          <i class="uil uil-times"></i>
        </div>
      </header>
      <div class="content">
        <p>Share via</p>
        <ul class="icons">

          $for share_link in share_links:
          $ track_tag = share_link['text'].replace(' ', '-')
            
              <a href="$share_link['url']" class="sansserif large" target="_blank" data-ol-link-track="Share|$track_tag">
                <img title="Share on $(share_link['text'])" alt="$(share_link['text'])" class="share-link" src="$static_url('images/%s.svg' % share_link['text'].lower())"/>
              </a>
              
            

          

          
        $# rm special characters from url such as single quote which break js prompt/iframe
        $ clean_url = page_url.replace("'", "\\'")
        $ iframe_html = str(embed_iframe(clean_url)).strip()
        <a class="embed-work-btn" title="$_('Embed this book in your website')" data-ol-link-track="Share|Embed"
          onclick="prompt('Copy embed code to clipboard:', '$iframe_html');">
          <img alt="Embed icon" class="share-link" src="$static_url('images/embed.png')">
        </a>
          



        </ul>
        <p>Or copy link</p>
        <div class="field">
          <i class="url-icon uil uil-link"></i>
          <input type="text" readonly value="$page_url">
          <button>Copy</button>
        </div>
      </div>
    </div>




    

    
  



<script>
  
  const viewBtn = document.querySelector(".view-modal"),
  popup = document.querySelector(".popup"),
  close = popup.querySelector(".close"),
  field = popup.querySelector(".field"),
  input = field.querySelector("input"),
  copy = field.querySelector("button");

  viewBtn.onclick = ()=>{
    popup.classList.toggle("show");
  }
  close.onclick = ()=>{
    viewBtn.click();
  }

  copy.onclick = ()=>{
    input.select(); //select input value
    if(document.execCommand("copy")){ //if the selected text copy
      field.classList.add("active");
      copy.innerText = "Copied";
      setTimeout(()=>{
        window.getSelection().removeAllRanges(); //remove selection from document
        field.classList.remove("active");
        copy.innerText = "Copy";
      }, 3000);
    }
  }

</script>





